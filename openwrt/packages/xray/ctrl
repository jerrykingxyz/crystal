#!/bin/sh

set -e

CUR_DIR=$(dirname "$(readlink -f -- "$0")")
OPENWRT_DIR=$(dirname $(dirname $CUR_DIR))
TEMP_DIR="$OPENWRT_DIR/temp_conf"
source $OPENWRT_DIR/utils

ACTION=$1
CFG_FILE="$CUR_DIR/config"
TEMPLATE_FILE="$CUR_DIR/template.cfg"
OUTPUT_CFG_FILE="$TEMP_DIR/xray_config.json"

if [ "$ACTION" = "setup" ]; then
    echo "setup"
fi

if [ "$ACTION" = "start" ]; then
    render_config $TEMPLATE_FILE $CFG_FILE > $OUTPUT_CFG_FILE
fi

if [ "$ACTION" = "stop" ]; then
    echo "stop"
fi
